NIP-46
======

Nostr Connect
-------------

`draft` `optional` `author:tiero` `author:giowe` `author:vforvalerio87` `author:pablof7z` `author:fiatjaf`

This NIP describes a method for 2-way communication between a **remote signer** and a normal Nostr client. The remote signer could be, for example, a hardware device dedicated to signing Nostr events, while the client is a normal Nostr client.

The remote signer generates a connection token in the form

```
<npub1...>#<secret>?relay=wss://...&relay=wss://...
```

The user copies that token and pastes it in the client UI somehow. Then the client can send events of kind `24133` to the specified relays and wait for responses from the remote signer.

The `secret` allows the signer to identify the client's key and, perhaps, assign it certain permissions (e.g. *sign only event `kind:7`, reject encrypt/decrypt requests*)

Event payloads are [NIP-04](04.md)-encrypted JSON blobs that look like JSONRPC.

Events sent by the client to the remote signer have the following format:

```js
{
  "pubkey": "<client-deterministically-generated-key-for-the-connection>"
  "kind": 24133,
  "tags": [
    ["p", "<user-pubkey-hex>"]
  ],
  "content": "nip04_encrypted_json({id: <random-string>, method: <see-below>, params: []})",
  ...
}
```

And the events the remote signer sends to the client have the following format:

```js
  "pubkey": "<user-pubkey>"
  "kind": 24133,
  "tags": [
    ["p", "<signer-pubkey-hex>"]
  ],
  "content": "nip04_encrypted_json({id: <request-id>, result: <any>, error: <reason-string>})",
  ...
```

### Methods

- **connect**
  - params: [`pubkey`, `secret`]
  - result: `null`
- **get_public_key**
  - params: []
  - result: `pubkey`
- **sign_event**
  - params: [`event`]
  - result: `event_with_pubkey_id_and_signature`
- **get_relays**
  - params: []
  - result: `{ [url: string]: {read: boolean, write: boolean} }`
- **nip04_encrypt**
  - params: [`pubkey`, `plaintext`]
  - result: `nip4 ciphertext`
- **nip04_decrypt**
  - params: [`pubkey`, `nip4 ciphertext`]
  - result: [`plaintext`]
